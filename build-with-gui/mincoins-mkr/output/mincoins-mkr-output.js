// MinCoins Maker Output - Helper functions for exporting layout data
// This module handles the export functionality for the MinCoins builder

export function formatLayoutForExport(signs) {
    // Format the signs data for export to mincoins-layout.js
    const layoutItems = signs.map(sign => {
        const item = {
            type: sign.type,
            x: sign.x,
            y: sign.y,
            width: sign.width,
            height: sign.height
        };
        
        // Only include text if it exists
        if (sign.text) {
            item.text = sign.text;
        }
        
        // Only include arrow if it exists
        if (sign.arrow) {
            item.arrow = sign.arrow;
        }
        
        return item;
    });
    
    return {
        items: layoutItems,
        timestamp: new Date().toISOString(),
        version: "1.0"
    };
}

export function generateLayoutCode(layoutData) {
    // Generate the JavaScript code that can be pasted into mincoins-layout.js
    const code = `// Generated by MinCoins Builder
// ${layoutData.timestamp}

export const layoutItems = ${JSON.stringify(layoutData.items, null, 4)};`;
    
    return code;
}

export function showExportDialog(layoutData) {
    const jsonString = JSON.stringify(layoutData, null, 2);
    const codeString = generateLayoutCode(layoutData);
    
    const popup = window.open('', 'MinCoins Layout Export', 'width=800,height=600,scrollbars=yes,resizable=yes');
    popup.document.write(`
        <html>
        <head>
            <title>MinCoins Layout Export</title>
            <style>
                body { 
                    font-family: monospace; 
                    padding: 20px;
                    background: #1e1e1e;
                    color: #fff;
                }
                h2 { color: #ffd700; }
                textarea { 
                    width: 100%; 
                    height: 200px; 
                    background: #2a2a2a;
                    color: #fff;
                    border: 1px solid #444;
                    padding: 10px;
                    font-family: monospace;
                }
                .section { margin-bottom: 30px; }
                button {
                    background: #4CAF50;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    cursor: pointer;
                    border-radius: 5px;
                }
                button:hover { background: #45a049; }
            </style>
        </head>
        <body>
            <h2>MinCoins Layout Export</h2>
            
            <div class="section">
                <h3>JavaScript Code (for mincoins-layout.js)</h3>
                <textarea readonly onclick="this.select()">${codeString}</textarea>
                <button onclick="navigator.clipboard.writeText(this.previousElementSibling.value)">Copy Code</button>
            </div>
            
            <div class="section">
                <h3>Raw JSON Data</h3>
                <textarea readonly onclick="this.select()">${jsonString}</textarea>
                <button onclick="navigator.clipboard.writeText(this.previousElementSibling.value)">Copy JSON</button>
            </div>
            
            <button onclick="window.close()">Close</button>
        </body>
        </html>
    `);
    popup.document.close();
}