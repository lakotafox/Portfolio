<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetBeans Area</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <!-- 
 
   
    
    The signs layout can be modified using the builder
   
    features:
    - walk with arrow keys or wasd
    - interact with signs using enter
    - type numbers on keyboard keys
    - run code with the run button
    - terminal shows mincoins program output

    -->
    <link rel="stylesheet" href="mincoins-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
</head>
<body>
    <canvas id="codeCanvas"></canvas>
    
    <!-- background music for mincoins -->
    <audio id="coinsMusic">
        <source src="../../sound-effects/coinstartup.mp3" type="audio/mpeg">
    </audio>
    <audio id="coinSound">
        <source src="../../sound-effects/COINS.mp3" type="audio/mpeg">
    </audio>
    <audio id="gcdSound">
        <source src="../../sound-effects/GREAT.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Initial popup modal -->
    <div class="welcome-modal" id="welcomeModal">
        <div class="modal-content">
            <p style="color: #ff9999; font-weight: bold; font-size: 1.2rem; margin-bottom: 10px;">⚠️ NO KEYBOARD TYPING!</p>
            <br>
            <p style="color: #99ff99; font-weight: bold; margin-bottom: 20px;">✓ Walk to buttons & press ENTER</p>
            <br>
            <div style="text-align: left;">
                <p>1. Walk with ↑↓←→ or WASD</p>
                <br>
                <p>2. Walk to green RUN button</p>
                <br>
                <p>3. Press ENTER to start</p>
                <br>
                <p>4. Walk to number buttons (0-9)</p>
                <br>
                <p>5. Press ENTER on each KEY</p>
                <br>
                <p>6. Walk to ENTER button to submit</p>
            </div>
            
            <button class="modal-ok-btn" onclick="closeWelcomeModal()">OK, Got it!</button>
        </div>
    </div>
    
    <!-- Collapsible help in corner -->
    <div class="instructions collapsed" id="helpPanel">
        <div class="help-header" onclick="toggleHelp()">
            <span id="helpIcon">❓</span> Help
        </div>
        <div class="help-content" id="helpContent">
            <p style="color: #ff9999; font-weight: bold;">⚠️ NO KEYBOARD TYPING!</p>
            <p style="color: #99ff99;">✓ Walk to buttons & press ENTER</p>
            <p style="margin-top: 10px;">↑↓←→ / WASD - Move</p>
            <p>Mouse - Look • Scroll - Zoom</p>
        </div>
    </div>
    
    <button class="exit-btn" id="exitBtn">✕ Exit to Map</button>

    <!-- Mobile Controls -->
    <div class="mobile-controls" id="mobileControls">
        <div class="dpad">
            <button class="dpad-btn dpad-up" data-key="ArrowUp">▲</button>
            <button class="dpad-btn dpad-left" data-key="ArrowLeft">◄</button>
            <button class="dpad-btn dpad-center" data-key="Enter">ENTER</button>
            <button class="dpad-btn dpad-right" data-key="ArrowRight">►</button>
            <button class="dpad-btn dpad-down" data-key="ArrowDown">▼</button>
        </div>
    </div>

    <!-- load the init script as a module with cache buster -->
    <script type="module" src="mincoins-init.js?v=2"></script>
    
    <!-- add modal and help functionality -->
    <script>
        // Modal functions
        function closeWelcomeModal() {
            document.getElementById('welcomeModal').classList.add('hidden');
        }
        
        // Help panel toggle
        function toggleHelp() {
            const helpPanel = document.getElementById('helpPanel');
            const helpIcon = document.getElementById('helpIcon');
            
            if (helpPanel.classList.contains('collapsed')) {
                helpPanel.classList.remove('collapsed');
                helpIcon.textContent = '✖';
            } else {
                helpPanel.classList.add('collapsed');
                helpIcon.textContent = '❓';
            }
        }
        
        // Exit button
        document.getElementById('exitBtn').addEventListener('click', function() {
            // go back to main game
            window.location.href = '../../index.html';
        });

        // Detect keyboard number typing attempts
        let typingWarningShown = false;
        document.addEventListener('keydown', function(e) {
            // Check if user is trying to type numbers (0-9 on main keyboard or numpad)
            const isNumber = (e.key >= '0' && e.key <= '9') ||
                           (e.code >= 'Digit0' && e.code <= 'Digit9') ||
                           (e.code >= 'Numpad0' && e.code <= 'Numpad9');

            if (isNumber && !typingWarningShown) {
                typingWarningShown = true;
                showTypingWarning();
                // Reset after 5 seconds so they can see it again if they forget
                setTimeout(() => {
                    typingWarningShown = false;
                }, 5000);
            }
        });

        function showTypingWarning() {
            // Create temporary warning popup
            const warning = document.createElement('div');
            warning.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.95);
                color: #ff9999;
                padding: 30px 40px;
                border: 3px solid #ff6666;
                border-radius: 15px;
                font-family: 'MedievalSharp', cursive;
                font-size: 1.5rem;
                text-align: center;
                z-index: 10000;
                box-shadow: 0 0 30px rgba(255, 102, 102, 0.5);
                animation: shake 0.5s;
            `;
            warning.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 10px;">⚠️</div>
                <div style="font-weight: bold; margin-bottom: 15px;">NO KEYBOARD TYPING!</div>
                <div style="color: #99ff99; font-size: 1.2rem;">Walk to number buttons</div>
                <div style="color: #99ff99; font-size: 1.2rem;">Press ENTER to select</div>
            `;

            document.body.appendChild(warning);

            // Auto-remove after 3 seconds
            setTimeout(() => {
                warning.style.opacity = '0';
                warning.style.transition = 'opacity 0.5s';
                setTimeout(() => warning.remove(), 500);
            }, 2500);
        }
        
        // music control
        const coinsMusic = document.getElementById('coinsMusic');
        let hasPlayed = false;
        if (coinsMusic) {
            coinsMusic.volume = 0.3;
            // start music on first interaction
            ['click', 'keydown'].forEach(e => {
                document.addEventListener(e, () => {
                    if (!hasPlayed) {
                        hasPlayed = true;
                        // play 3 times in rapid succession
                        coinsMusic.play().catch(err => console.log('Music error:', err));

                        // clone and play after some time
                        setTimeout(() => {
                            const sound2 = coinsMusic.cloneNode(true);
                            sound2.volume = 0.3;
                            sound2.play();
                        }, 100);

                        // clone and play after some time
                        setTimeout(() => {
                            const sound3 = coinsMusic.cloneNode(true);
                            sound3.volume = 0.3;
                            sound3.play();
                        }, 400);
                    }
                }, { once: true });
            });
        }

        // Mobile controls handler
        document.addEventListener('DOMContentLoaded', function() {
            const mobileButtons = document.querySelectorAll('.dpad-btn');

            mobileButtons.forEach(button => {
                // Handle touch/click
                button.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    const key = this.getAttribute('data-key');
                    // Simulate keydown event
                    const event = new KeyboardEvent('keydown', {
                        key: key,
                        bubbles: true
                    });
                    document.dispatchEvent(event);
                });

                button.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    const key = this.getAttribute('data-key');
                    // Simulate keyup event
                    const event = new KeyboardEvent('keyup', {
                        key: key,
                        bubbles: true
                    });
                    document.dispatchEvent(event);
                });

                // Also handle mouse clicks for testing
                button.addEventListener('mousedown', function(e) {
                    const key = this.getAttribute('data-key');
                    const event = new KeyboardEvent('keydown', {
                        key: key,
                        bubbles: true
                    });
                    document.dispatchEvent(event);
                });

                button.addEventListener('mouseup', function(e) {
                    const key = this.getAttribute('data-key');
                    const event = new KeyboardEvent('keyup', {
                        key: key,
                        bubbles: true
                    });
                    document.dispatchEvent(event);
                });
            });
        });
    </script>
</body>
</html>