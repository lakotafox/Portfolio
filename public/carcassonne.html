<!DOCTYPE html>
<html lang="en">
<head>
    <!-- character encoding - tells browser how to interpret text characters -->
    <meta charset="UTF-8">
    
    <!--  settings for  mobile devices -->
    <!-- width=device-width: Sets view width to match device screen width -->
   
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- page title shown in browser tab -->
    <title>Carcassonne Portfolio</title>
    
    <!-- favicon - Carcassonne tile -->
    <link rel="icon" type="image/png" href="carc-map-favicon.png">
    
    <!-- link to CSS styling for page -->
    <link rel="stylesheet" href="carc-map-styles.css">
    
    <!--fonts: Loads MedievalSharp font aesthetic -->
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
</head>
<body>
    <!-- main container for  game world??????? -->
    <div class="game-world">
        
        <!--game is drawn/rendered carc tiles, player sprite, and map -->

        <!-- use javascript to draw 2D graphics -->
        <canvas id="gameCanvas"></canvas>
        
        <!-- container for all UI elements that overlay the game -->
        <div class="game-ui">

            <!-- Back to Main Portfolio Button -->
            <a href="index.html" class="back-button">← Back to Portfolio</a>

            <!-- instructions panel (top-left corner) -->
            <!-- shows player how to control the game -->
            <div class="instructions" id="instructions">
                <h3 class="instructions-header" onclick="toggleInstructions()">How to play ▶</h3>
                <div class="instructions-content" id="instructionsContent" style="display: none;">
                    <button class="close-btn-small" onclick="toggleInstructions()">×</button>
                    <h4>Controls</h4>
                    <p>Arrow Keys / WASD - Move</p>
                    <p>Enter - View Project</p>
                    <p>M - Toggle Music</p>
                    <hr>
                    <p>Purple flag = Ready to view!</p>
                    <p>Red flag = Unfinished project</p>
                </div>
            </div>
            
            <!-- Background music -->
            <audio id="bgMusic" loop>
                <source src="sound-effects/carcasonetheme.mp3" type="audio/mpeg">
            </audio>
            
            <!--  info panel (appears when near a flag) -->
           
            <div class="city-info" id="cityInfo">
                
                <h2 id="cityName"></h2>
              
                <p id="cityDesc"></p>
                <!--  tell user press Enter -->
                <div class="enter-prompt" onclick="handleEnterPromptClick()" style="cursor: pointer;">Press ENTER to view</div>
            </div>
        </div>

        <!-- Mobile Controls -->
        <div class="mobile-controls" id="mobileControls">
            <div class="dpad">
                <button class="dpad-btn dpad-up" data-key="ArrowUp">▲</button>
                <button class="dpad-btn dpad-left" data-key="ArrowLeft">◄</button>
                <button class="dpad-btn dpad-center" data-key="Enter">ENTER</button>
                <button class="dpad-btn dpad-right" data-key="ArrowRight">►</button>
                <button class="dpad-btn dpad-down" data-key="ArrowDown">▼</button>
            </div>
        </div>

        <!-- player presses Enter near a flag becomes visible -->
        <div class="project-viewer" id="projectViewer">
            <!-- iframe loads the actual project content (like mincoins-area) -->
            <iframe id="projectFrame"></iframe>
            <!-- close button to return to the main map -->
            <button class="close-btn" onclick="closeProject()">X Close (ESC)</button>
        </div>

        <!-- How to Play Modal (appears on page load) -->
        <div class="modal-overlay" id="howToPlayModal">
            <div class="modal-content">
                <h2>Welcome to Carcassonne Portfolio!</h2>
                <div class="modal-body">
                    <div class="modal-section">
                        <h3>Controls</h3>
                        <p><strong>Arrow Keys / WASD</strong> - Move your character</p>
                        <p><strong>Enter</strong> - View project when near a flag</p>
                        <p><strong>M</strong> - Toggle music</p>
                    </div>

                    <div class="modal-section">
                        <h3>Flag System</h3>
                        <p><strong style="color: #b19cd9;">Purple Flag</strong> - Completed project, ready to explore!</p>
                        <p><strong style="color: #ff6b6b;">Red Flag</strong> - Work in progress, not yet available</p>
                    </div>

                    <div class="modal-section">
                        <h3>About Projects</h3>
                        <p>Walk around the Carcassonne map to discover various coding projects. When you approach a purple flag, press <strong>Enter</strong> to view the project in detail.</p>
                    </div>
                </div>
                <button class="modal-btn" onclick="closeHowToPlay()">Start Exploring!</button>
            </div>
        </div>
    </div>
    
  
    
    <!-- projects-global.js: Project/marker management -->
    <script src="game-engine/projects/projects-global.js"></script>
    
    <!-- big-bang.js: Main game logic - world creation and game loop -->
    <!-- Uses ES6 modules to import player-birth.js and camera.js -->
    <script type="module" src="game-engine/big-bang.js"></script>
    
    <script>
        // toggle help panel open/closed
        function toggleInstructions() {
            const content = document.getElementById('instructionsContent');
            const header = document.querySelector('.instructions-header');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                header.innerHTML = 'How to play ▼'; // down arrow when open
            } else {
                content.style.display = 'none';
                header.innerHTML = 'How to play ▶'; // right arrow when closed
            }
        }

        // Show How to Play modal on page load
        window.addEventListener('load', function() {
            document.getElementById('howToPlayModal').style.display = 'flex';
        });

        function closeHowToPlay() {
            document.getElementById('howToPlayModal').style.display = 'none';
        }

        // Handle click on "Press ENTER to view" prompt
        function handleEnterPromptClick() {
            // Simulate Enter key press
            const event = new KeyboardEvent('keydown', {
                key: 'Enter',
                bubbles: true
            });
            document.dispatchEvent(event);
        }

        // Mobile controls handler
        document.addEventListener('DOMContentLoaded', function() {
            const mobileButtons = document.querySelectorAll('.dpad-btn');

            mobileButtons.forEach(button => {
                // Handle touch/click
                button.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    const key = this.getAttribute('data-key');
                    // Simulate keydown event
                    const event = new KeyboardEvent('keydown', {
                        key: key,
                        bubbles: true
                    });
                    document.dispatchEvent(event);
                });

                button.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    const key = this.getAttribute('data-key');
                    // Simulate keyup event
                    const event = new KeyboardEvent('keyup', {
                        key: key,
                        bubbles: true
                    });
                    document.dispatchEvent(event);
                });

                // Also handle mouse clicks for testing
                button.addEventListener('mousedown', function(e) {
                    const key = this.getAttribute('data-key');
                    const event = new KeyboardEvent('keydown', {
                        key: key,
                        bubbles: true
                    });
                    document.dispatchEvent(event);
                });

                button.addEventListener('mouseup', function(e) {
                    const key = this.getAttribute('data-key');
                    const event = new KeyboardEvent('keyup', {
                        key: key,
                        bubbles: true
                    });
                    document.dispatchEvent(event);
                });
            });
        });
    </script>
</body>
</html>